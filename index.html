<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Josh's Simple Gains</title>
   <style>
       * { margin: 0; padding: 0; box-sizing: border-box; }
       body { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif; background: #000; min-height: 100vh; padding: 16px; color: #fff; }
       .container { max-width: 480px; margin: 0 auto; background: linear-gradient(145deg, #1d1d1f 0%, #121212 100%); border: 1px solid rgba(255,255,255,0.08); border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.6); overflow: hidden; }
       .header { background: linear-gradient(135deg, #1d1d1f 0%, #2d2d2f 100%); padding: 24px 24px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.08); }
       .header h1 { font-size: 22px; font-weight: 600; letter-spacing: -0.5px; margin-bottom: 2px; }
       .header p { font-size: 13px; color: rgba(255,255,255,0.5); }
       .workout-selector { display: flex; background: rgba(255,255,255,0.08); padding: 6px; gap: 4px; }
       .workout-btn { flex: 1; padding: 12px 8px; border: none; background: transparent; border-radius: 8px; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s; color: rgba(255,255,255,0.5); text-transform: uppercase; }
       .workout-btn:hover { background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.8); }
       .workout-btn.active { background: rgba(255,255,255,0.12); color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
       .content { padding: 16px 14px; }
       .exercise-card { background: #fff; border-radius: 16px; padding: 16px; margin-bottom: 10px; box-shadow: 0 4px 16px rgba(0,0,0,0.4); }
       .exercise-title { font-size: 16px; font-weight: 600; color: #1d1d1f; margin-bottom: 10px; }
       .weight-row { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
       .weight-label { font-size: 14px; font-weight: 500; color: rgba(60,60,67,0.8); }
       .weight-input-inline { width: 75px; padding: 8px 12px; border: 1.5px solid rgba(0,0,0,0.12); background: #fafafa; border-radius: 8px; font-size: 15px; font-weight: 600; color: #1d1d1f; text-align: center; transition: all 0.2s; }
       .weight-input-inline:focus { outline: none; border-color: #1d1d1f; background: #fff; }
       .ready-badge { display: inline-block; background: linear-gradient(135deg, #34a853 0%, #2d9648 100%); color: #fff; padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: 600; text-transform: uppercase; margin-left: 8px; }
       .timer-display { font-size: 48px; font-weight: 300; text-align: center; color: #1d1d1f; margin: 8px 0 12px; font-variant-numeric: tabular-nums; }
       .timer-btn { width: 100%; padding: 14px; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; text-transform: uppercase; }
       .timer-btn.start { background: linear-gradient(135deg, #1ed760 0%, #1db954 100%); color: #fff; }
       .timer-btn.stop { background: linear-gradient(135deg, #ff3b30 0%, #e32119 100%); color: #fff; }
       .timer-btn.done { background: rgba(120,120,128,0.16); color: rgba(60,60,67,0.6); cursor: default; }
       .status { text-align: center; padding: 8px; border-radius: 8px; margin-top: 8px; font-size: 13px; }
       .status.success { background: rgba(52,168,83,0.15); color: rgba(30,132,73,1); border: 1px solid rgba(52,168,83,0.2); }
       .status.warning { background: rgba(255,149,0,0.15); color: rgba(201,115,0,1); border: 1px solid rgba(255,149,0,0.2); }
       .history-section { margin-top: 20px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.08); }
       .history-exercise { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 12px; margin-bottom: 10px; }
       .history-exercise-title { font-size: 13px; font-weight: 600; color: rgba(255,255,255,0.9); margin-bottom: 8px; }
       .history-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 12px; }
       .history-row:last-child { border-bottom: none; }
       .history-date { color: rgba(255,255,255,0.5); }
       .history-sets { color: rgba(255,255,255,0.8); }
   </style>
</head>
<body>
   <div class="container">
       <div class="header">
           <h1>Josh's Simple Gains</h1>
           <p>Target: 40-70 seconds per set</p>
       </div>
       <div class="workout-selector">
           <button class="workout-btn active" data-workout="1">Mon<br>Push/Pull</button>
           <button class="workout-btn" data-workout="2">Wed<br>Legs</button>
           <button class="workout-btn" data-workout="3">Fri<br>Back/Shoulders</button>
       </div>
       <div class="content" id="workoutContent"></div>
   </div>

   <script>
       const workouts = {
           1: { name: "Push/Pull", exercises: ["Incline Press", "Bench Press", "Pullover", "Overhead Press", "Bent-Over Row", "Single-Arm Row"] },
           2: { name: "Legs", exercises: ["Goblet Squat", "Trap Bar Deadlift", "Walking Lunges", "Romanian Deadlift"] },
           3: { name: "Back/Shoulders", exercises: ["Alternating Row", "Trap Bar Shrug", "Lateral Raise", "Banded Upright Row"] }
       };

       let currentWorkout = 1;
       let timers = {};
       let audioCtx = null;

       function getAudioContext() {
           if (!audioCtx) {
               audioCtx = new (window.AudioContext || window.webkitAudioContext)();
           }
           if (audioCtx.state === 'suspended') {
               audioCtx.resume();
           }
           return audioCtx;
       }

       function playBeep(freq, duration) {
           try {
               const ctx = getAudioContext();
               const osc = ctx.createOscillator();
               const gain = ctx.createGain();
               osc.connect(gain);
               gain.connect(ctx.destination);
               osc.frequency.value = freq;
               osc.type = 'sine';
               gain.gain.setValueAtTime(0.5, ctx.currentTime);
               gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration / 1000);
               osc.start(ctx.currentTime);
               osc.stop(ctx.currentTime + duration / 1000);
           } catch (e) {
               console.log('Audio error:', e);
           }
       }

       function initApp() {
           loadWorkout(1);
           document.querySelectorAll('.workout-btn').forEach(btn => {
               btn.addEventListener('click', () => {
                   document.querySelectorAll('.workout-btn').forEach(b => b.classList.remove('active'));
                   btn.classList.add('active');
                   currentWorkout = parseInt(btn.dataset.workout);
                   loadWorkout(currentWorkout);
               });
           });
       }

       function loadWorkout(workoutNum) {
           const workout = workouts[workoutNum];
           const content = document.getElementById('workoutContent');
           const today = new Date().toISOString().split('T')[0];
           const history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');

           let html = '';
           workout.exercises.forEach((exercise, idx) => {
               html += `
                   <div class="exercise-card">
                       <div class="exercise-title">${exercise}</div>
                       <div class="weight-row">
                           <label class="weight-label">Weight:</label>
                           <input type="number" id="weight-${idx}" class="weight-input-inline" placeholder="lbs" step="5">
                           <span id="ready-badge-${idx}" class="ready-badge" style="display: none;">Ready to increase</span>
                       </div>
                       <div class="timer-display" id="timer-${idx}">00:00</div>
                       <button class="timer-btn start" id="btn-${idx}" onclick="startTimer(${idx})">Start Timer</button>
                       <input type="hidden" id="time-${idx}" value="0">
                       <div id="status-${idx}"></div>
                   </div>`;
           });

           // History section
           html += '<div class="history-section"><h3 style="color: #fff; font-size: 14px; margin-bottom: 12px; font-weight: 600;">Recent History</h3>';
           workout.exercises.forEach(exercise => {
               const exerciseHistory = history
                   .filter(h => h.exercise === exercise && h.workout === workout.name)
                   .sort((a, b) => new Date(b.date) - new Date(a.date))
                   .slice(0, 5);
               if (exerciseHistory.length > 0) {
                   html += `<div class="history-exercise"><div class="history-exercise-title">${exercise}</div>`;
                   exerciseHistory.forEach(entry => {
                       const dateStr = new Date(entry.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                       const weight = entry.weight || (entry.sets && entry.sets[0] ? entry.sets[0].weight : 0);
                       const time = entry.time || (entry.sets && entry.sets[0] ? entry.sets[0].time : 0);
                       html += `<div class="history-row"><span class="history-date">${dateStr}</span><span class="history-sets">${weight}lb × ${time}s</span></div>`;
                   });
                   html += '</div>';
               }
           });
           html += '</div>';

           content.innerHTML = html;
           loadSavedData(workoutNum);
       }

       function loadSavedData(workoutNum) {
           const workout = workouts[workoutNum];
           const today = new Date().toISOString().split('T')[0];
           const history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');

           workout.exercises.forEach((exercise, idx) => {
               const lastEntry = history
                   .filter(h => h.exercise === exercise && h.workout === workout.name)
                   .sort((a, b) => new Date(b.date) - new Date(a.date))[0];

               if (lastEntry) {
                   const weightInput = document.getElementById(`weight-${idx}`);
                   const readyBadge = document.getElementById(`ready-badge-${idx}`);
                   if (weightInput) {
                       const entryTime = lastEntry.time || (lastEntry.sets && lastEntry.sets[0] ? lastEntry.sets[0].time : 0);
                       const lastWeight = lastEntry.weight || (lastEntry.sets && lastEntry.sets[0] ? lastEntry.sets[0].weight : 0);
                       const over70 = entryTime >= 70;
                       const isToday = lastEntry.date === today;
                       if (over70 && !isToday) {
                           weightInput.value = lastWeight + 5;
                           if (readyBadge) readyBadge.style.display = 'inline-block';
                       } else {
                           weightInput.value = lastWeight;
                       }
                   }
               }
           });
       }

       function startTimer(exerciseIdx) {
           const timerId = `${exerciseIdx}`;
           const timerDisplay = document.getElementById(`timer-${timerId}`);
           const timeInput = document.getElementById(`time-${timerId}`);
           const btn = document.getElementById(`btn-${exerciseIdx}`);

           if (btn.classList.contains('done')) return;

           const weightInput = document.getElementById(`weight-${exerciseIdx}`);
           if (!weightInput.value || parseFloat(weightInput.value) <= 0) {
               weightInput.style.border = '2px solid #ff3b30';
               weightInput.focus();
               setTimeout(() => { weightInput.style.border = '1.5px solid rgba(0,0,0,0.12)'; }, 2000);
               return;
           }

           if (timers[timerId]) {
               clearInterval(timers[timerId].interval);
               delete timers[timerId];
               btn.textContent = 'Done';
               btn.className = 'timer-btn done';

               const workout = workouts[currentWorkout];
               const exerciseName = workout.exercises[exerciseIdx];
               const weight = weightInput.value;
               const time = timeInput.value;
               const today = new Date().toISOString().split('T')[0];

               if (weight && time) {
                   let history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
                   let existingEntry = history.find(h => h.date === today && h.exercise === exerciseName && h.workout === workout.name);

                   if (existingEntry) {
                       existingEntry.weight = parseFloat(weight);
                       existingEntry.time = parseInt(time);
                   } else {
                       history.push({
                           date: today, workout: workout.name, exercise: exerciseName,
                           weight: parseFloat(weight), time: parseInt(time)
                       });
                   }
                   localStorage.setItem('workoutHistory', JSON.stringify(history));
                   updateHistorySection();

                   const statusDiv = document.getElementById(`status-${exerciseIdx}`);
                   if (statusDiv) {
                       const timeVal = parseInt(time);
                       if (timeVal >= 70) {
                           statusDiv.className = 'status success';
                           statusDiv.textContent = '✓ Saved! Increase weight next time';
                       } else if (timeVal >= 40) {
                           statusDiv.className = 'status success';
                           statusDiv.textContent = '✓ Saved!';
                       } else {
                           statusDiv.className = 'status warning';
                           statusDiv.textContent = '✓ Saved';
                       }
                       setTimeout(() => { statusDiv.textContent = ''; statusDiv.className = ''; }, 2000);
                   }
               }
               return;
           }

           // Countdown
           let countdown = 5;
           timerDisplay.textContent = `00:0${countdown}`;
           timerDisplay.style.color = '#ff9500';
           btn.textContent = 'Get Ready...';
           btn.className = 'timer-btn stop';
           playBeep(660, 100);

           const countdownInterval = setInterval(() => {
               countdown--;
               if (countdown > 0) {
                   timerDisplay.textContent = `00:0${countdown}`;
                   playBeep(660, 100);
               } else {
                   timerDisplay.textContent = '00:00';
                   playBeep(880, 300);
                   clearInterval(countdownInterval);

                   const startTime = Date.now();
                   let beeped70 = false;
                   timerDisplay.style.color = '#1d1d1f';
                   btn.textContent = 'Stop Timer';

                   timers[timerId] = {
                       interval: setInterval(() => {
                           const elapsed = Math.floor((Date.now() - startTime) / 1000);
                           timeInput.value = elapsed;
                           const mins = Math.floor(elapsed / 60);
                           const secs = elapsed % 60;
                           timerDisplay.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

                           if (elapsed === 70 && !beeped70) {
                               beeped70 = true;
                               playBeep(1100, 200);
                               setTimeout(() => playBeep(1100, 200), 250);
                               if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
                               timerDisplay.style.color = '#34a853';
                           }
                       }, 100)
                   };
               }
           }, 1000);

           timers[timerId] = { interval: countdownInterval };
       }

       initApp();
   </script>
</body>
</html>
