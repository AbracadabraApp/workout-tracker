<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Josh's Simple Gains</title>
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
       }

       body {
           font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
           background: #000000;
           min-height: 100vh;
           min-height: -webkit-fill-available;
           padding: 20px;
           color: #ffffff;
           -webkit-text-size-adjust: 100%;
           -webkit-tap-highlight-color: transparent;
       }

       html {
           height: -webkit-fill-available;
       }

       .container {
           max-width: 480px;
           margin: 0 auto;
           background: linear-gradient(145deg, #1d1d1f 0%, #121212 100%);
           border: 1px solid rgba(255, 255, 255, 0.08);
           border-radius: 24px;
           box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6),
                       0 4px 12px rgba(0, 0, 0, 0.4);
           overflow: hidden;
       }

       .header {
           background: linear-gradient(135deg, #1d1d1f 0%, #2d2d2f 100%);
           color: #ffffff;
           padding: 32px 24px 28px;
           text-align: center;
           border-bottom: 1px solid rgba(255, 255, 255, 0.08);
       }

       .header h1 {
           font-size: 24px;
           font-weight: 600;
           letter-spacing: -0.6px;
           margin-bottom: 4px;
       }

       .header p {
           font-size: 13px;
           color: rgba(255, 255, 255, 0.5);
           font-weight: 400;
           letter-spacing: 0.3px;
       }

       .workout-selector {
           display: flex;
           background: rgba(255, 255, 255, 0.08);
           padding: 8px;
           gap: 6px;
       }

       .workout-btn {
           flex: 1;
           padding: 14px 10px;
           border: none;
           background: transparent;
           border-radius: 10px;
           font-size: 12px;
           font-weight: 600;
           cursor: pointer;
           transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
           color: rgba(255, 255, 255, 0.5);
           letter-spacing: 0.3px;
           text-transform: uppercase;
           -webkit-tap-highlight-color: transparent;
           touch-action: manipulation;
       }

       .workout-btn:hover {
           background: rgba(255, 255, 255, 0.08);
           color: rgba(255, 255, 255, 0.8);
       }

       .workout-btn.active {
           background: rgba(255, 255, 255, 0.12);
           color: #ffffff;
           box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
       }

       .content {
           padding: 20px 16px;
       }

       .exercise-card {
           background: #ffffff;
           border: 1px solid rgba(0, 0, 0, 0.1);
           border-radius: 16px;
           padding: 20px;
           margin-bottom: 12px;
           box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
           transition: all 0.2s;
       }

       .exercise-card:hover {
           box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
           transform: translateY(-2px);
       }

       .exercise-title {
           font-size: 19px;
           font-weight: 600;
           color: #1d1d1f;
           margin-bottom: 14px;
           letter-spacing: -0.4px;
       }

       .weight-row {
           display: flex;
           align-items: center;
           gap: 10px;
           margin-bottom: 18px;
           padding-bottom: 16px;
           border-bottom: 1px solid rgba(0, 0, 0, 0.06);
       }

       .weight-label {
           font-size: 15px;
           font-weight: 500;
           color: rgba(60, 60, 67, 0.8);
           letter-spacing: 0.2px;
       }

       .weight-input-inline {
           width: 75px;
           padding: 8px 12px;
           border: 1.5px solid rgba(0, 0, 0, 0.12);
           background: #fafafa;
           border-radius: 8px;
           font-size: 15px;
           font-weight: 600;
           color: #1d1d1f;
           text-align: center;
           transition: all 0.2s;
           -webkit-appearance: none;
           appearance: none;
       }

       .weight-input-inline::placeholder {
           color: rgba(60, 60, 67, 0.3);
           font-size: 13px;
           font-weight: 400;
       }

       .weight-input-inline:focus {
           outline: none;
           border-color: #1d1d1f;
           background: #ffffff;
           box-shadow: 0 0 0 3px rgba(29, 29, 31, 0.06);
       }

       .ready-badge {
           display: inline-block;
           background: linear-gradient(135deg, #34a853 0%, #2d9648 100%);
           color: #ffffff;
           padding: 8px 12px;
           border-radius: 6px;
           font-size: 12px;
           font-weight: 500;
           letter-spacing: 0.2px;
           margin-left: 8px;
           box-shadow: 0 2px 8px rgba(52, 168, 83, 0.25);
       }

       .set-container {
           background: #fafafa;
           border: 1px solid rgba(0, 0, 0, 0.04);
           border-radius: 12px;
           padding: 16px;
           margin-bottom: 10px;
       }

       .set-label {
           font-size: 15px;
           font-weight: 500;
           color: rgba(60, 60, 67, 0.8);
           margin-bottom: 12px;
           letter-spacing: 0.2px;
       }

       .timer-display {
           font-size: 52px;
           font-weight: 300;
           text-align: center;
           color: #1d1d1f;
           margin: 12px 0 16px;
           font-variant-numeric: tabular-nums;
           letter-spacing: -2px;
           min-height: 65px;
       }
       
       .timer-display.countdown {
           font-size: 72px;
           font-weight: 600;
           color: #ff9500;
       }

       .timer-btn {
           width: 100%;
           padding: 15px;
           border: none;
           border-radius: 10px;
           font-size: 14px;
           font-weight: 600;
           cursor: pointer;
           transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
           margin-bottom: 10px;
           letter-spacing: 0.3px;
           text-transform: uppercase;
           -webkit-tap-highlight-color: transparent;
           touch-action: manipulation;
       }

       .timer-btn.start {
           background: linear-gradient(135deg, #1ed760 0%, #1db954 100%);
           color: #ffffff;
           box-shadow: 0 4px 12px rgba(30, 215, 96, 0.25);
       }

       .timer-btn.start:hover {
           background: linear-gradient(135deg, #1fdf67 0%, #1ec55b 100%);
           box-shadow: 0 6px 16px rgba(30, 215, 96, 0.3);
           transform: translateY(-1px);
       }

       .timer-btn.start:active {
           transform: scale(0.98);
       }

       .timer-btn.stop {
           background: linear-gradient(135deg, #ff3b30 0%, #e32119 100%);
           color: #ffffff;
           box-shadow: 0 4px 12px rgba(255, 59, 48, 0.25);
       }

       .timer-btn.stop:hover {
           background: linear-gradient(135deg, #ff4940 0%, #ed2f25 100%);
           box-shadow: 0 6px 16px rgba(255, 59, 48, 0.3);
           transform: translateY(-1px);
       }

       .timer-btn.stop:active {
           transform: scale(0.98);
       }

       .timer-btn.done {
           background: rgba(120, 120, 128, 0.16);
           color: rgba(60, 60, 67, 0.6);
           border: 1px solid rgba(0, 0, 0, 0.1);
           cursor: default;
           box-shadow: none;
       }

       .timer-btn.done:hover {
           background: rgba(120, 120, 128, 0.16);
           color: rgba(60, 60, 67, 0.6);
           transform: none;
       }

       .timer-btn.done:active {
           transform: none;
       }

       .save-btn {
           width: 100%;
           padding: 16px;
           background: rgba(60, 60, 67, 0.85);
           color: #ffffff;
           border: 1px solid rgba(0, 0, 0, 0.3);
           backdrop-filter: blur(20px);
           -webkit-backdrop-filter: blur(20px);
           border-radius: 12px;
           font-size: 15px;
           font-weight: 500;
           cursor: pointer;
           margin-top: 12px;
           transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
           letter-spacing: 0.2px;
           -webkit-tap-highlight-color: transparent;
           touch-action: manipulation;
       }

       .save-btn:hover {
           background: rgba(60, 60, 67, 1);
           border-color: rgba(0, 0, 0, 0.4);
           transform: translateY(-1px);
           box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
       }

       .save-btn:active {
           transform: scale(0.98);
       }

       .history-btn {
           width: 100%;
           padding: 14px;
           background: rgba(88, 86, 214, 0.12);
           color: rgba(88, 86, 214, 1);
           border: 1px solid rgba(88, 86, 214, 0.2);
           backdrop-filter: blur(20px);
           -webkit-backdrop-filter: blur(20px);
           border-radius: 12px;
           font-size: 14px;
           font-weight: 500;
           cursor: pointer;
           margin-top: 20px;
           transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
           letter-spacing: 0.2px;
           -webkit-tap-highlight-color: transparent;
           touch-action: manipulation;
       }

       .history-btn:hover {
           background: rgba(88, 86, 214, 0.18);
           border-color: rgba(88, 86, 214, 0.3);
       }

       .status {
           text-align: center;
           padding: 10px;
           border-radius: 10px;
           margin-top: 10px;
           font-size: 13px;
           backdrop-filter: blur(20px);
           -webkit-backdrop-filter: blur(20px);
           letter-spacing: 0.2px;
       }

       .status.success {
           background: rgba(52, 168, 83, 0.15);
           color: rgba(30, 132, 73, 1);
           border: 1px solid rgba(52, 168, 83, 0.2);
       }

       .status.warning {
           background: rgba(255, 149, 0, 0.15);
           color: rgba(201, 115, 0, 1);
           border: 1px solid rgba(255, 149, 0, 0.2);
       }

       .modal {
           display: none;
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: rgba(0, 0, 0, 0.3);
           backdrop-filter: blur(20px);
           -webkit-backdrop-filter: blur(20px);
           z-index: 1000;
       }

       .modal.show {
           display: flex;
           align-items: center;
           justify-content: center;
       }

       .modal-content {
           background: rgba(255, 255, 255, 0.95);
           backdrop-filter: blur(40px);
           -webkit-backdrop-filter: blur(40px);
           border: 1px solid rgba(0, 0, 0, 0.1);
           border-radius: 24px;
           padding: 24px;
           max-width: 90%;
           max-height: 80vh;
           overflow-y: auto;
           box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
       }

       .modal-header {
           display: flex;
           justify-content: space-between;
           align-items: center;
           margin-bottom: 20px;
       }

       .modal-header h2 {
           color: #1d1d1f;
           font-size: 22px;
           font-weight: 600;
           letter-spacing: -0.5px;
       }

       .close-btn {
           background: rgba(120, 120, 128, 0.12);
           border: 1px solid rgba(0, 0, 0, 0.08);
           width: 32px;
           height: 32px;
           border-radius: 50%;
           font-size: 20px;
           cursor: pointer;
           color: rgba(60, 60, 67, 0.6);
           transition: all 0.2s;
           display: flex;
           align-items: center;
           justify-content: center;
       }

       .close-btn:hover {
           background: rgba(120, 120, 128, 0.18);
           color: rgba(60, 60, 67, 0.9);
       }

       .history-item {
           background: rgba(242, 242, 247, 0.6);
           backdrop-filter: blur(20px);
           -webkit-backdrop-filter: blur(20px);
           border: 1px solid rgba(0, 0, 0, 0.08);
           padding: 14px;
           border-radius: 12px;
           margin-bottom: 10px;
       }

       .history-item-header {
           font-weight: 600;
           color: #1d1d1f;
           margin-bottom: 6px;
           font-size: 15px;
           letter-spacing: -0.2px;
       }

       .history-item-details {
           font-size: 13px;
           color: rgba(60, 60, 67, 0.6);
           letter-spacing: 0.2px;
       }
   </style>
</head>
<body>
   <div class="container">
       <div class="header">
           <h1>Josh's Simple Gains</h1>
           <p>Target: 40-70 seconds per set</p>
       </div>

       <div class="workout-selector">
           <button class="workout-btn active" data-workout="1">Mon<br>Push/Pull</button>
           <button class="workout-btn" data-workout="2">Wed<br>Legs</button>
           <button class="workout-btn" data-workout="3">Fri<br>Back/Shoulders</button>
       </div>

       <div class="content" id="workoutContent"></div>
   </div>

   <script>
       'use strict';
       
       const workouts = {
           1: {
               name: "Push/Pull",
               exercises: ["Incline Press", "Bench Press", "Pullover", "Overhead Press", "Single-Arm Row"]
           },
           2: {
               name: "Legs",
               exercises: ["Goblet Squat", "Trap Bar Deadlift", "Walking Lunges", "Romanian Deadlift"]
           },
           3: {
               name: "Back/Shoulders",
               exercises: ["Alternating Row", "Trap Bar Shrug", "Lateral Raise", "Banded Upright Row"]
           }
       };

       let currentWorkout = 1;
       let timers = {};

       function initApp() {
           // Set up button listeners first
           const buttons = document.querySelectorAll('.workout-btn');
           
           buttons.forEach(btn => {
               btn.addEventListener('click', function(e) {
                   e.preventDefault();
                   e.stopPropagation();
                   
                   const workoutNum = parseInt(this.getAttribute('data-workout'));
                   
                   // Remove active from all buttons
                   buttons.forEach(b => b.classList.remove('active'));
                   
                   // Add active to clicked button
                   this.classList.add('active');
                   
                   // Update current workout
                   currentWorkout = workoutNum;
                   
                   // Load workout
                   loadWorkout(workoutNum);
               });
           });
           
           // Load initial workout after a short delay
           setTimeout(() => {
               loadWorkout(1);
           }, 100);
       }

       function loadWorkout(workoutNum) {
           const workout = workouts[workoutNum];
           if (!workout) {
               return;
           }
           
           const content = document.getElementById('workoutContent');
           if (!content) {
               return;
           }
           
           // Clear existing content
           content.innerHTML = '';
           
           // Update button states
           document.querySelectorAll('.workout-btn').forEach(btn => {
               const btnWorkout = parseInt(btn.getAttribute('data-workout'));
               if (btnWorkout === workoutNum) {
                   btn.classList.add('active');
               } else {
                   btn.classList.remove('active');
               }
           });
           
           const today = new Date().toISOString().split('T')[0];
           let history = [];
           try {
               history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
           } catch (e) {
               // localStorage not available
           }

           let htmlParts = [];

           workout.exercises.forEach((exercise, idx) => {
               let exerciseHTML = '<div class="exercise-card">';
               exerciseHTML += '<div class="exercise-title">' + exercise + '</div>';
               exerciseHTML += '<div class="weight-row">';
               exerciseHTML += '<label class="weight-label">Weight:</label>';
               exerciseHTML += '<input type="number" id="weight-' + idx + '" class="weight-input-inline" placeholder="lbs" step="5">';
               exerciseHTML += '<span id="ready-badge-' + idx + '" class="ready-badge" style="display: none;"></span>';
               exerciseHTML += '</div>';

               // Add sets
               for (let setNum = 1; setNum <= 2; setNum++) {
                   exerciseHTML += '<div class="set-container">';
                   exerciseHTML += '<div class="set-label">Set ' + setNum + '</div>';
                   exerciseHTML += '<div class="timer-display" id="timer-' + idx + '-' + setNum + '">00:00</div>';
                   exerciseHTML += '<button class="timer-btn start" data-exercise="' + idx + '" data-set="' + setNum + '">Start Timer</button>';
                   exerciseHTML += '<input type="hidden" id="time-' + idx + '-' + setNum + '" value="0">';
                   exerciseHTML += '<div id="status-' + idx + '-' + setNum + '"></div>';
                   exerciseHTML += '</div>';
               }

               exerciseHTML += '</div>';
               htmlParts.push(exerciseHTML);
           });

           // Add report link
           htmlParts.push('<div style="text-align: center; margin-top: 24px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.08);"><a href="#" id="reportLink" style="color: rgba(255, 255, 255, 0.6); text-decoration: none; font-size: 14px; font-weight: 500; transition: color 0.2s;" onmouseover="this.style.color=\'#ffffff\'" onmouseout="this.style.color=\'rgba(255, 255, 255, 0.6)\'">Download Progress Report</a></div>');

           const finalHTML = htmlParts.join('');
           content.innerHTML = finalHTML;

           // Load saved data
           loadSavedData(workoutNum);

           // Add event listeners to timer buttons
           content.querySelectorAll('.timer-btn').forEach(function(btn) {
               btn.addEventListener('click', function(e) {
                   e.preventDefault();
                   const exerciseIdx = parseInt(this.getAttribute('data-exercise'));
                   const setNum = parseInt(this.getAttribute('data-set'));
                   startTimer(exerciseIdx, setNum, this);
               });
           });

           // Add event listeners to hide ready badge when weight is manually changed
           workout.exercises.forEach((exercise, idx) => {
               const weightInput = document.getElementById('weight-' + idx);
               const readyBadge = document.getElementById('ready-badge-' + idx);
               
               if (weightInput && readyBadge) {
                   weightInput.addEventListener('input', function() {
                       readyBadge.style.display = 'none';
                   });
               }
           });
           
           // Add event listener to report link
           const reportLink = document.getElementById('reportLink');
           if (reportLink) {
               reportLink.addEventListener('click', function(e) {
                   e.preventDefault();
                   generateReport();
               });
           }
       }

       function generateReport() {
           const history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');

           if (history.length === 0) {
               alert('No workout data yet. Complete some workouts first!');
               return;
           }

           // Analyze data
           const allExercises = [...new Set(history.map(h => h.exercise))];
           const reportData = [];
           const today = new Date();
           const oneWeekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
           const fourWeeksAgo = new Date(today.getTime() - 28 * 24 * 60 * 60 * 1000);

           allExercises.forEach(exercise => {
               const exerciseHistory = history
                   .filter(h => h.exercise === exercise)
                   .sort((a, b) => new Date(a.date) - new Date(b.date));

               if (exerciseHistory.length === 0) return;

               // Get all valid workouts (both sets in range)
               const validWorkouts = exerciseHistory.filter(entry =>
                   entry.sets.length === 2 &&
                   entry.sets.every(set => set.time >= 40 && set.time <= 70)
               );

               const firstWeight = exerciseHistory[0].sets[0]?.weight || 0;
               const lastWeight = exerciseHistory[exerciseHistory.length - 1].sets[0]?.weight || 0;
               const bestWeight = validWorkouts.length > 0
                   ? Math.max(...validWorkouts.map(w => w.sets[0].weight))
                   : 0;

               // Check for plateau (same weight for 3+ consecutive workouts)
               let plateauCount = 0;
               if (exerciseHistory.length >= 3) {
                   const lastThree = exerciseHistory.slice(-3);
                   const weights = lastThree.map(e => e.sets[0]?.weight);
                   if (weights.every(w => w === weights[0])) {
                       plateauCount = 3;
                   }
               }

               // Recent activity
               const recentWorkouts = exerciseHistory.filter(e =>
                   new Date(e.date) >= fourWeeksAgo
               );

               // Success rate (sets in target range)
               const allSets = exerciseHistory.flatMap(e => e.sets);
               const successfulSets = allSets.filter(s => s.time >= 40 && s.time <= 70).length;
               const successRate = Math.round((successfulSets / allSets.length) * 100);

               reportData.push({
                   exercise,
                   firstWeight,
                   lastWeight,
                   bestWeight,
                   gain: lastWeight - firstWeight,
                   gainPercent: firstWeight > 0 ? Math.round(((lastWeight - firstWeight) / firstWeight) * 100) : 0,
                   totalWorkouts: exerciseHistory.length,
                   recentWorkouts: recentWorkouts.length,
                   plateau: plateauCount >= 3,
                   successRate,
                   dates: exerciseHistory.map(e => e.date),
                   weights: exerciseHistory.map(e => e.sets[0]?.weight || 0)
               });
           });

           // Generate HTML report
           let reportHTML = `<!DOCTYPE html>
<html>
<head>
   <meta charset="UTF-8">
   <title>Josh's Simple Gains - Progress Report</title>
   <style>
       body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; color: #1d1d1f; }
       h1 { font-size: 28px; margin-bottom: 8px; }
       .subtitle { color: #666; font-size: 14px; margin-bottom: 32px; }
       .summary { background: #f5f5f7; padding: 24px; border-radius: 12px; margin-bottom: 32px; }
       .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
       .stat { text-align: center; }
       .stat-value { font-size: 32px; font-weight: 600; color: #1d1d1f; }
       .stat-label { font-size: 13px; color: #666; margin-top: 4px; }
       .exercise-section { margin-bottom: 32px; page-break-inside: avoid; }
       .exercise-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
       .exercise-name { font-size: 18px; font-weight: 600; }
       .gain { font-size: 16px; font-weight: 500; }
       .gain.positive { color: #34a853; }
       .gain.neutral { color: #666; }
       .progress-bar { height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden; margin-bottom: 12px; }
       .progress-fill { height: 100%; background: linear-gradient(90deg, #34a853 0%, #4caf50 100%); }
       .details { font-size: 13px; color: #666; line-height: 1.6; }
       .alert { background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px 16px; border-radius: 4px; margin-top: 8px; font-size: 13px; }
       .pr-badge { background: #34a853; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
       @media print { body { margin: 20px; } .no-print { display: none; } }
   </style>
</head>
<body>
   <h1>Progress Report</h1>
   <div class="subtitle">Generated ${today.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>

   <div class="summary">
       <div class="summary-grid">
           <div class="stat">
               <div class="stat-value">${history.length}</div>
               <div class="stat-label">Total Workouts</div>
           </div>
           <div class="stat">
               <div class="stat-value">${allExercises.length}</div>
               <div class="stat-label">Exercises Tracked</div>
           </div>
           <div class="stat">
               <div class="stat-value">${reportData.filter(r => r.gain > 0).length}</div>
               <div class="stat-label">Exercises Improving</div>
           </div>
       </div>
   </div>

   <h2 style="margin-bottom: 20px;">Exercise Progress</h2>
`;

           reportData.sort((a, b) => b.gainPercent - a.gainPercent).forEach(data => {
               const gainClass = data.gain > 0 ? 'positive' : 'neutral';
               const progressPercent = data.bestWeight > 0 ? Math.min((data.lastWeight / data.bestWeight) * 100, 100) : 0;

               reportHTML += `
   <div class="exercise-section">
       <div class="exercise-header">
           <div class="exercise-name">${data.exercise}</div>
           <div class="gain ${gainClass}">
               ${data.firstWeight} → ${data.lastWeight} lbs
               ${data.gain > 0 ? `(+${data.gain} lbs, +${data.gainPercent}%)` : ''}
           </div>
       </div>
       <div class="progress-bar">
           <div class="progress-fill" style="width: ${progressPercent}%"></div>
       </div>
       <div class="details">
           ${data.bestWeight > 0 ? `<span class="pr-badge">PR: ${data.bestWeight} lbs</span> ` : ''}
           ${data.totalWorkouts} total workouts •
           ${data.recentWorkouts} in last 4 weeks •
           ${data.successRate}% of sets in target range (40-70s)
       </div>
       ${data.plateau ? '<div class="alert">⚠️ Plateau detected - same weight for 3+ workouts. Consider increasing weight or adjusting form.</div>' : ''}
       ${data.recentWorkouts === 0 ? '<div class="alert">⚠️ No activity in the last 4 weeks</div>' : ''}
   </div>
`;
           });

           reportHTML += `
   <div style="margin-top: 48px; padding-top: 24px; border-top: 2px solid #e0e0e0; font-size: 12px; color: #999; text-align: center;">
       Josh's Simple Gains • Time Under Tension Training
   </div>
</body>
</html>`;

           // Create and download
           const blob = new Blob([reportHTML], { type: 'text/html' });
           const url = URL.createObjectURL(blob);
           const a = document.createElement('a');
           a.href = url;
           a.download = `progress-report-${today.toISOString().split('T')[0]}.html`;
           document.body.appendChild(a);
           a.click();
           document.body.removeChild(a);
           URL.revokeObjectURL(url);
       }

       function startTimer(exerciseIdx, setNum, btn) {
           const timerId = exerciseIdx + '-' + setNum;
           const timerDisplay = document.getElementById('timer-' + timerId);
           const timeInput = document.getElementById('time-' + timerId);

           // Don't allow interaction if button is in 'done' state
           if (btn && btn.classList.contains('done')) {
               return;
           }

           if (timers[timerId]) {
               // Stop timer - auto-save
               clearInterval(timers[timerId].interval);
               delete timers[timerId];
               
               // Keep timer display visible - don't reset
               timerDisplay.classList.remove('countdown');
               
               // Button stays grey and says Done
               btn.textContent = 'Done';
               btn.className = 'timer-btn done';

               // Auto-save
               const workout = workouts[currentWorkout];
               const exerciseName = workout.exercises[exerciseIdx];
               const weight = document.getElementById('weight-' + exerciseIdx).value;
               const time = timeInput.value;
               const today = new Date().toISOString().split('T')[0];

               if (weight && time) {
                   let history = [];
                   try {
                       history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
                   } catch (e) {
                       history = [];
                   }
                   
                   let existingEntry = history.find(function(h) {
                       return h.date === today && h.exercise === exerciseName && h.workout === workout.name;
                   });

                   if (existingEntry) {
                       const existingSet = existingEntry.sets.find(function(s) {
                           return s.set === setNum;
                       });
                       if (existingSet) {
                           existingSet.weight = parseFloat(weight);
                           existingSet.time = parseInt(time);
                       } else {
                           existingEntry.sets.push({
                               set: setNum,
                               weight: parseFloat(weight),
                               time: parseInt(time)
                           });
                       }
                   } else {
                       history.push({
                           date: today,
                           workout: workout.name,
                           exercise: exerciseName,
                           sets: [{
                               set: setNum,
                               weight: parseFloat(weight),
                               time: parseInt(time)
                           }]
                       });
                   }

                   try {
                       localStorage.setItem('workoutHistory', JSON.stringify(history));
                   } catch (e) {
                       // localStorage not available
                   }

                   // Show feedback
                   const statusDiv = document.getElementById('status-' + exerciseIdx + '-' + setNum);
                   if (statusDiv) {
                       const timeVal = parseInt(time);
                       if (timeVal >= 70) {
                           statusDiv.className = 'status success';
                           statusDiv.textContent = '✓ Saved! Great time!';
                       } else if (timeVal >= 40) {
                           statusDiv.className = 'status success';
                           statusDiv.textContent = '✓ Saved!';
                       } else {
                           statusDiv.className = 'status warning';
                           statusDiv.textContent = '✓ Saved';
                       }
                       setTimeout(function() {
                           statusDiv.textContent = '';
                           statusDiv.className = '';
                       }, 2000);
                   }

                   // Reload to update badge
                   loadWorkout(currentWorkout);
               }
           } else {
               // Start countdown
               let countdown = 5;
               timerDisplay.classList.add('countdown');
               timerDisplay.textContent = countdown;
               btn.textContent = 'Starting...';
               btn.className = 'timer-btn stop';
               
               const countdownInterval = setInterval(function() {
                   countdown--;
                   if (countdown > 0) {
                       timerDisplay.textContent = countdown;
                   } else if (countdown === 0) {
                       timerDisplay.textContent = 'GO!';
                   } else {
                       // Countdown done, start actual timer
                       clearInterval(countdownInterval);
                       timerDisplay.classList.remove('countdown');
                       timerDisplay.textContent = '00:00';
                       timeInput.value = 0;
                       
                       const startTime = Date.now();
                       
                       timers[timerId] = {
                           interval: setInterval(function() {
                               const elapsed = Math.floor((Date.now() - startTime) / 1000);
                               timeInput.value = elapsed;

                               const mins = Math.floor(elapsed / 60);
                               const secs = elapsed % 60;
                               timerDisplay.textContent = (mins < 10 ? '0' : '') + mins + ':' + (secs < 10 ? '0' : '') + secs;

                               // Alarm at 150 seconds
                               if (elapsed === 150) {
                                   if (navigator.vibrate) {
                                       navigator.vibrate([200, 100, 200, 100, 200]);
                                   }
                               }
                           }, 100)
                       };
                       
                       btn.textContent = 'Stop Timer';
                   }
               }, 1000);
           }
       }


       function loadSavedData(workoutNum) {
           const workout = workouts[workoutNum];
           const today = new Date().toISOString().split('T')[0];
           let history = [];
           try {
               history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
           } catch (e) {
               return;
           }

           // Get last workout data for each exercise
           workout.exercises.forEach((exercise, idx) => {
               const lastEntry = history
                   .filter(function(h) { return h.exercise === exercise && h.workout === workout.name; })
                   .sort(function(a, b) { return new Date(b.date) - new Date(a.date); })[0];

               if (lastEntry && lastEntry.sets.length > 0) {
                   const weightInput = document.getElementById('weight-' + idx);
                   const readyBadge = document.getElementById('ready-badge-' + idx);
                   
                   if (weightInput) {
                       const lastWeight = lastEntry.sets[0].weight;
                       
                       // Always set to last workout weight (don't auto-increment)
                       weightInput.value = lastWeight;
                       
                       // Check if BOTH sets hit 70+ seconds
                       const bothSetsOver70 = lastEntry.sets.length === 2 && 
                                             lastEntry.sets.every(function(set) { return set.time >= 70; });
                       
                       if (bothSetsOver70 && readyBadge) {
                           // Check if this is from today - if so, don't show badge (already did the increase)
                           const isToday = lastEntry.date === today;
                           
                           if (!isToday) {
                               readyBadge.textContent = 'Ready to increase! You hit 70+ seconds on both sets last time';
                               readyBadge.style.display = 'inline-block';
                               weightInput.style.background = 'rgba(52, 168, 83, 0.08)';
                           }
                       }
                   }
               }
           });
       }


       // Initialize app - use DOMContentLoaded for better iOS compatibility
       if (document.readyState === 'loading') {
           document.addEventListener('DOMContentLoaded', initApp);
       } else {
           initApp();
       }
   </script>
</body>
</html>
